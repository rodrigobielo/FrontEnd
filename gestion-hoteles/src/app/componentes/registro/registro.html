<div class="p-4 p-md-5">
  <!-- Encabezado -->
  <div class="text-center mb-4">
    <div class="mb-3">
      <i class="bi bi-person-plus-fill text-primary display-4"></i>
    </div>
    <h2 class="fw-bold mb-2" style="color: #1a365d;">Registro de Usuario</h2>
    <p class="text-muted mb-0">Complete todos los campos para crear su cuenta</p>
  </div>

  @if (mensajeExito) {
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      <i class="bi bi-check-circle me-2"></i>{{ mensajeExito }}
      <button type="button" class="btn-close" (click)="mensajeExito = ''"></button>
    </div>
  }

  @if (mensajeError) {
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      <i class="bi bi-exclamation-triangle me-2"></i>{{ mensajeError }}
      <button type="button" class="btn-close" (click)="mensajeError = ''"></button>
    </div>
  }

  <form [formGroup]="registroForm" (ngSubmit)="onSubmit()" novalidate class="needs-validation">
    
    <!-- Sección: Información Personal -->
    <div class="card border-0 shadow-sm mb-4">
      <div class="card-header bg-transparent border-bottom">
        <h5 class="mb-0 fw-semibold text-primary">
          <i class="bi bi-person-vcard me-2"></i>Información Personal
        </h5>
      </div>
      <div class="card-body">
        <!-- Nombre y Apellidos -->
        <div class="row g-3">
          <div class="col-md-6">
            <label for="nombre" class="form-label fw-medium">
              <i class="bi bi-person me-1 text-primary"></i>Nombre <span class="text-danger">*</span>
            </label>
            <input 
              type="text" 
              class="form-control form-control-lg" 
              id="nombre"
              formControlName="nombre"
              [class.is-valid]="campoValido('nombre')"
              [class.is-invalid]="campoInvalido('nombre')"
              placeholder="Ingrese su nombre">
            @if (mostrarError('nombre')) {
              <div class="invalid-feedback">
                @if (f['nombre'].errors?.['required']) {
                  <div><i class="bi bi-exclamation-circle me-1"></i>El nombre es obligatorio</div>
                }
                @if (f['nombre'].errors?.['pattern']) {
                  <div><i class="bi bi-exclamation-circle me-1"></i>2-50 letras (solo caracteres válidos)</div>
                }
              </div>
            }
          </div>
          
          <div class="col-md-6">
            <label for="apellidos" class="form-label fw-medium">
              <i class="bi bi-person-badge me-1 text-primary"></i>Apellidos <span class="text-danger">*</span>
            </label>
            <input 
              type="text" 
              class="form-control form-control-lg" 
              id="apellidos"
              formControlName="apellidos"
              [class.is-valid]="campoValido('apellidos')"
              [class.is-invalid]="campoInvalido('apellidos')"
              placeholder="Introduzca sus apellidos">
            @if (mostrarError('apellidos')) {
              <div class="invalid-feedback">
                @if (f['apellidos'].errors?.['required']) {
                  <div><i class="bi bi-exclamation-circle me-1"></i>Los apellidos son obligatorios</div>
                }
                @if (f['apellidos'].errors?.['pattern']) {
                  <div><i class="bi bi-exclamation-circle me-1"></i>2-80 letras (solo caracteres válidos)</div>
                }
              </div>
            }
          </div>
        </div>

        <!-- Teléfono y Nacionalidad -->
        <div class="row g-3 mt-3">
          <div class="col-md-6">
            <label for="telefono" class="form-label fw-medium">
              <i class="bi bi-telephone me-1 text-primary"></i>Teléfono <span class="text-danger">*</span>
            </label>
            <input 
              type="tel" 
              class="form-control form-control-lg" 
              id="telefono"
              formControlName="telefono"
              [class.is-valid]="campoValido('telefono')"
              [class.is-invalid]="campoInvalido('telefono')"
              placeholder="Ej. 600123456">
            @if (mostrarError('telefono')) {
              <div class="invalid-feedback">
                @if (f['telefono'].errors?.['required']) {
                  <div><i class="bi bi-exclamation-circle me-1"></i>El teléfono es obligatorio</div>
                }
                @if (f['telefono'].errors?.['pattern']) {
                  <div><i class="bi bi-exclamation-circle me-1"></i>8-20 dígitos</div>
                }
              </div>
            }
          </div>
          
          <div class="col-md-6">
            <label for="nacionalidad" class="form-label fw-medium">
              <i class="bi bi-globe me-1 text-primary"></i>Nacionalidad <span class="text-danger">*</span>
            </label>
            <input 
              type="text" 
              class="form-control form-control-lg" 
              id="nacionalidad"
              formControlName="nacionalidad"
              [class.is-valid]="campoValido('nacionalidad')"
              [class.is-invalid]="campoInvalido('nacionalidad')"
              placeholder="Ej. Española">
            @if (mostrarError('nacionalidad')) {
              <div class="invalid-feedback">
                @if (f['nacionalidad'].errors?.['required']) {
                  <div><i class="bi bi-exclamation-circle me-1"></i>La nacionalidad es obligatoria</div>
                }
                @if (f['nacionalidad'].errors?.['pattern']) {
                  <div><i class="bi bi-exclamation-circle me-1"></i>3-50 letras (solo caracteres válidos)</div>
                }
              </div>
            }
          </div>
        </div>
      </div>
    </div>

    <!-- Sección: Documentación -->
    <div class="card border-0 shadow-sm mb-4">
      <div class="card-header bg-transparent border-bottom">
        <h5 class="mb-0 fw-semibold text-primary">
          <i class="bi bi-file-earmark-text me-2"></i>Documentación
        </h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-12">
            <label for="numPasaporte" class="form-label fw-medium">
              <i class="bi bi-card-text me-1 text-primary"></i>DNI o Pasaporte <span class="text-danger">*</span>
            </label>
            <input 
              type="text" 
              class="form-control form-control-lg" 
              id="numPasaporte"
              formControlName="numPasaporte"
              [class.is-valid]="campoValido('numPasaporte')"
              [class.is-invalid]="campoInvalido('numPasaporte')"
              placeholder="Ej. 12345678A o ABC123456">
            @if (mostrarError('numPasaporte')) {
              <div class="invalid-feedback">
                @if (f['numPasaporte'].errors?.['required']) {
                  <div><i class="bi bi-exclamation-circle me-1"></i>El documento es obligatorio</div>
                }
                @if (f['numPasaporte'].errors?.['pattern']) {
                  <div><i class="bi bi-exclamation-circle me-1"></i>5-20 caracteres alfanuméricos</div>
                }
              </div>
            }
          </div>
        </div>
      </div>
    </div>

    <!-- Sección: Credenciales -->
    <div class="card border-0 shadow-sm mb-4">
      <div class="card-header bg-transparent border-bottom">
        <h5 class="mb-0 fw-semibold text-primary">
          <i class="bi bi-shield-lock me-2"></i>Credenciales de Acceso
        </h5>
      </div>
      <div class="card-body">
        <!-- Email -->
        <div class="row g-3">
          <div class="col-md-6">
            <label for="email" class="form-label fw-medium">
              <i class="bi bi-envelope me-1 text-primary"></i>Correo Electrónico <span class="text-danger">*</span>
            </label>
            <input 
              type="email" 
              class="form-control form-control-lg" 
              id="email"
              formControlName="email"
              [class.is-valid]="campoValido('email')"
              [class.is-invalid]="campoInvalido('email')"
              placeholder="ejemplo@correo.com">
            @if (mostrarError('email')) {
              <div class="invalid-feedback">
                @if (f['email'].errors?.['required']) {
                  <div><i class="bi bi-exclamation-circle me-1"></i>El correo electrónico es obligatorio</div>
                }
                @if (f['email'].errors?.['email']) {
                  <div><i class="bi bi-exclamation-circle me-1"></i>Formato de correo inválido</div>
                }
              </div>
            }
          </div>
        </div>

        <div class="row g-3 mt-3">
          <div class="col-md-6">
            <label for="usuario" class="form-label fw-medium">
              <i class="bi bi-person-circle me-1 text-primary"></i>Usuario <span class="text-danger">*</span>
            </label>
            <input 
              type="text" 
              class="form-control form-control-lg" 
              id="usuario"
              formControlName="usuario"
              [class.is-valid]="campoValido('usuario')"
              [class.is-invalid]="campoInvalido('usuario')"
              placeholder="4-20 caracteres">
            @if (mostrarError('usuario')) {
              <div class="invalid-feedback">
                @if (f['usuario'].errors?.['required']) {
                  <div><i class="bi bi-exclamation-circle me-1"></i>El usuario es obligatorio</div>
                }
                @if (f['usuario'].errors?.['pattern']) {
                  <div><i class="bi bi-exclamation-circle me-1"></i>4-20 caracteres (letras, números, guión bajo)</div>
                }
              </div>
            }
            <small class="form-text text-muted mt-1 d-block">
              <i class="bi bi-info-circle me-1"></i>No se permiten espacios ni caracteres especiales
            </small>
          </div>
          
          <div class="col-md-6">
            <label for="contrasena" class="form-label fw-medium">
              <i class="bi bi-key me-1 text-primary"></i>Contraseña <span class="text-danger">*</span>
            </label>
            <input 
              type="password" 
              class="form-control form-control-lg" 
              id="contrasena"
              formControlName="contrasena"
              [class.is-valid]="campoValido('contrasena')"
              [class.is-invalid]="campoInvalido('contrasena')"
              placeholder="••••••••">
            @if (mostrarError('contrasena')) {
              <div class="invalid-feedback">
                @if (f['contrasena'].errors?.['required']) {
                  <div><i class="bi bi-exclamation-circle me-1"></i>La contraseña es obligatoria</div>
                }
                @if (f['contrasena'].errors?.['pattern']) {
                  <div><i class="bi bi-exclamation-circle me-1"></i>8+ caracteres con mayúscula, minúscula, número y carácter especial</div>
                }
              </div>
            }
            <small class="form-text text-muted mt-1 d-block">
              <i class="bi bi-lightbulb me-1"></i>Mínimo 8 caracteres con mayúscula, minúscula, número y carácter especial
            </small>
          </div>
        </div>

        <!-- Confirmar Contraseña -->
        <div class="row g-3 mt-3">
          <div class="col-md-6 offset-md-6">
            <label for="confirmarContrasena" class="form-label fw-medium">
              <i class="bi bi-key-fill me-1 text-primary"></i>Confirmar Contraseña <span class="text-danger">*</span>
            </label>
            <input 
              type="password" 
              class="form-control form-control-lg" 
              id="confirmarContrasena"
              formControlName="confirmarContrasena"
              [class.is-valid]="campoValido('confirmarContrasena') && registroForm.errors?.['contrasenasNoCoinciden'] === undefined"
              [class.is-invalid]="campoInvalido('confirmarContrasena') || registroForm.errors?.['contrasenasNoCoinciden']"
              placeholder="••••••••">
            @if (mostrarError('confirmarContrasena') || registroForm.errors?.['contrasenasNoCoinciden']) {
              <div class="invalid-feedback">
                @if (f['confirmarContrasena'].errors?.['required']) {
                  <div><i class="bi bi-exclamation-circle me-1"></i>Confirme la contraseña</div>
                }
                @if (registroForm.errors?.['contrasenasNoCoinciden']) {
                  <div><i class="bi bi-exclamation-circle me-1"></i>Las contraseñas no coinciden</div>
                }
              </div>
            }
          </div>
        </div>
      </div>
    </div>

    <!-- Mensaje de advertencia -->
    <div class="alert alert-warning mb-4">
      <i class="bi bi-exclamation-triangle me-2"></i>
      <small class="fw-medium">
        Todos los campos marcados con <span class="text-danger">*</span> son obligatorios.
        Por favor, verifique que toda la información sea correcta antes de enviar.
      </small>
    </div>

    <!-- Botones de acción -->
    <div class="d-grid gap-2 mb-4">
      <button 
        type="submit" 
        class="btn btn-primary btn-lg py-3 fw-semibold"
        [disabled]="registroForm.invalid || isLoading">
        @if (!isLoading) {
          <span><i class="bi bi-person-plus me-1"></i>Registrarse</span>
        }
        @if (isLoading) {
          <span><span class="spinner-border spinner-border-sm me-1" role="status"></span>Enviando...</span>
        }
      </button>

      <button 
        type="button" 
        class="btn btn-outline-secondary btn-lg py-3"
        (click)="limpiarFormulario()"
        [disabled]="isLoading">
        <i class="bi bi-arrow-counterclockwise me-1"></i>Limpiar Formulario
      </button>
    </div>
  </form>

  <!-- Enlace a login -->
  <div class="text-center pt-3 border-top">
    <p class="text-muted mb-2">¿Ya tiene una cuenta?</p>
    <button type="button" class="btn btn-outline-primary w-100 py-2 fw-medium" (click)="onIrALogin()">
      <i class="bi bi-box-arrow-in-right me-2"></i>Iniciar Sesión
    </button>
  </div>

  <!-- Footer -->
  <div class="text-center mt-4">
    <p class="small text-muted">
      <i class="bi bi-shield-check me-1"></i>
      Su información está protegida y encriptada. Al registrarse, acepta nuestros 
      <a href="#" class="text-decoration-none fw-medium">Términos de Servicio</a> 
      y 
      <a href="#" class="text-decoration-none fw-medium">Política de Privacidad</a>
    </p>
  </div>
</div>